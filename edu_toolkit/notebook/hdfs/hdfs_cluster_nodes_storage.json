{"paragraphs":[{"text":"%md\n# About\n\n**Lab:** Managing Cluster Nodes Storage\n**Objective:** To balance HDFS data blocks across DataNodes and balance block across all disk with in a DataNode.\n**File Locations:** N/A\n**Successful Outcome:** Run the HDFS balancer to spread data block across the cluster and run the HDFS diskbalancer to spread blocks evenly across the disk with in a single DataNode.\n**Before You Begin:** Start and connect to your classroom lab environment.\n**Related Lessons:** \n\n---","user":"allan_admin","dateUpdated":"2023-02-11T17:05:48-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>About</h1>\n<p><strong>Lab:</strong> Managing Cluster Nodes Storage<br />\n<strong>Objective:</strong> To balance HDFS data blocks across DataNodes and balance block across all disk with in a DataNode.<br />\n<strong>File Locations:</strong> N/A<br />\n<strong>Successful Outcome:</strong> Run the HDFS balancer to spread data block across the cluster and run the HDFS diskbalancer to spread blocks evenly across the disk with in a single DataNode.<br />\n<strong>Before You Begin:</strong> Start and connect to your classroom lab environment.<br />\n<strong>Related Lessons:</strong></p>\n<hr />\n\n</div>"}]},"apps":[],"jobName":"paragraph_1676161450239_-1013989960","id":"20200501-214558_1717013358","dateCreated":"2023-02-11T16:24:10-0800","dateStarted":"2023-02-11T17:05:48-0800","dateFinished":"2023-02-11T17:05:48-0800","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:65276"},{"text":"%md\n# Setup","user":"allan_admin","dateUpdated":"2023-02-11T17:06:07-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Setup</h1>\n\n</div>"}]},"apps":[],"jobName":"paragraph_1676161450240_1504493199","id":"20200501-215036_1976291396","dateCreated":"2023-02-11T16:24:10-0800","dateStarted":"2023-02-11T17:06:07-0800","dateFinished":"2023-02-11T17:06:07-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:65277"},{"text":"%md\n# Lab","user":"allan_admin","dateUpdated":"2023-02-11T17:06:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Lab</h1>\n\n</div>"}]},"apps":[],"jobName":"paragraph_1676161450240_-624767097","id":"20200501-215049_96830641","dateCreated":"2023-02-11T16:24:10-0800","dateStarted":"2023-02-11T17:06:10-0800","dateFinished":"2023-02-11T17:06:10-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:65278"},{"text":"%md\n### Rebalancing HDFS Cluster Storage\n\n**Check and rebalance HDFS storage.**\n\nWhenever you add more DataNodes, the new DataNodes are initially under-utilized because they do not contain any data blocks. Running the HDFS balancer will move data blocks to the new DataNodes.","user":"allan_admin","dateUpdated":"2023-02-11T17:06:13-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Rebalancing HDFS Cluster Storage</h3>\n<p><strong>Check and rebalance HDFS storage.</strong></p>\n<p>Whenever you add more DataNodes, the new DataNodes are initially under-utilized because they do not contain any data blocks. Running the HDFS balancer will move data blocks to the new DataNodes.</p>\n\n</div>"}]},"apps":[],"jobName":"paragraph_1676161450241_1735742872","id":"20200502-234428_1853656996","dateCreated":"2023-02-11T16:24:10-0800","dateStarted":"2023-02-11T17:06:13-0800","dateFinished":"2023-02-11T17:06:13-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:65279"},{"title":"1 - Open the HDFS page in Ambari","text":"%md\nIn the Ambari Web UI, click **Services** and select **HDFS**.\n\n*** !!! Image here !!! ***","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450241_-1770167740","id":"20200502-234427_1364646318","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65280"},{"title":"2 - Open the NameNode UI","text":"%md\nSelect **NameNode UI** from the **Quick Links** menu on the right.\n\n*** !!! Image here !!! ***","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450242_1799744386","id":"20200502-234426_1556584246","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65281"},{"title":"3 - Select the DataNodes tab","text":"%md\nClick the **DataNodes** tab in the **NameNode UI**.\n\n*** !!! Image here !!! ***","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450242_313766051","id":"20200502-234425_1286534398","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65282"},{"title":"4 - Observe the distribution of data blocks","text":"%md\nFor the DataNodes, compare the numbers in the **Used**, **Blocks**, and **Block pool used** columns.\n\n*** !!! Image here !!! ***\n\nThe more evenly matched the numbers are across the DataNodes, the more balanced the data blocks are across the DataNodes.\n\n**NOTE:** There is very little data in HDFS in the current lab environment so any differences between DataNodes will be very small. However, we just added a new host to the cluster, which means that original hosts might have slightly more data blocks.","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450243_-1799519317","id":"20200502-234424_972650866","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65283"},{"title":"5 - Determine HDFS balance from the command line","text":"%md\n**OPTIONAL**\nUse SSH to login to any cluster node, become the HDFS superuser, and run the command\n```\nhdfs dfsadmin -report\n```\n\nCompare the **DFS Used** and **DFS Remaining** values to determine HDFS balance.","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450243_-2068482907","id":"20200502-234424_2041461759","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65284"},{"text":"%sh\nsu - hdfs\nhdfs dfsadmin -report","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450243_309027934","id":"20200502-234423_1310285385","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65285"},{"title":"6 - In Ambari, navigate to the HDFS page","text":"%md\nIn the Ambari Web UI, ensure that **Services** and **HDFS** are selected.","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450244_-2024195741","id":"20200502-234422_1187122356","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65286"},{"title":"7 - Rebalance HDFS","text":"%md\nClick the **Service Actions** menu button and then select **Rebalance HDFS**.\n\n*** !!! Image here !!! ***","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450244_-1211055189","id":"20200502-234421_2088904808","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65287"},{"title":"8 - Start the rebalancing process","text":"%md\nIn the Rebalance HDFS window, accept the default of ten percent and click **Start**.\n\n*** !!! Image here !!! ***\n\nIf the DataNodes are balanced to within ten percent the balancer program will not take any action other than just evaluating the DataNodes. No data blocks will be moved.\n\nIf the DataNodes are not balanced to within ten percent then the balancer program\nwill shuffle data blocks between DataNodes.","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450245_1028501833","id":"20200502-234421_543174911","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65288"},{"title":"9 - Monitor the background  operations","text":"%md\nMonitor the Background Operations Running window until the Rebalance HDFS process has completed. Then click **OK** to dismiss the window.\n\nBecause there is so little data, and the default replication factor was one when most of the HDFS files were created, the balancer might not shuffle any data blocks.","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450245_1741152958","id":"20200502-234420_916582618","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65289"},{"text":"%md\n### Rebalancing HDFS Disk Storage\n\n**Check and rebalance HDFS disk storage.**\n\nDisks on a DataNode can have an uneven spread of data because of reasons such as large amount of writes and deletes or disk replacement. To ensure uniformity in the distribution of data across disks of a specified DataNode, the Disk Balancer operates against the DataNode and moves data blocks from one disk to another.\n\nWhenever you replace a disk, this disk will be under-utilized because the disk(s) do not contain any data blocks. When there are large amounts of writes and/or deletes the disks on the DataNodes can become over/under utilized. \n\nRunning the HDFS disk balancer will move data blocks to the evenly spread the blocks across all disks within a DataNode.","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450245_-600711352","id":"20200502-234419_1396551050","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65290"},{"title":"10 - Determine if a DataNode needs rebalancing","text":"%md\nTo determine if a DataNode is in need of rebalancing. Use SSH to login to any cluster node, become the HDFS superuser, and run the command\n```\nhdfs diskbalancer -plan <FQDN of DataNode>\n```\n\n*** !!! Output here !!! ***","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450246_1681735880","id":"20200502-234419_1071207585","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65291"},{"title":"11 - If needed, start the rebalancing process","text":"%md\nIf the datanode needed rebalancing this command would generate a \"PLAN\" to be used with the execute sub command. To start the disk rebalancing run the command\n```\nhdfs diskbalancer -execute <JSON file path>\n```","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450246_-1399888051","id":"20200502-234418_908106748","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65292"},{"title":"12 - Check the status of the rebalancing process","text":"%md\nOnce the rebalancing is running you can check the status of the execution by running the command \n```\nhdfs diskbalancer -query <FQDN of DataNode>\n```","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450246_603174019","id":"20200502-234417_1653908786","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65293"},{"title":"13 - Stopping the rebalancing process","text":"%md\nTo stop the rebalancing run the command \n```\nhdfs diskbalancer -cancel <JSON file path>\n```","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450247_992435274","id":"20200502-234416_1451327615","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65294"},{"text":"%md\n# Result\n\n**You have now:** Balanced your cluster by running the HDFS balancer and balanced a data node by running the HDFS diskbalancer command.","user":"allan_admin","dateUpdated":"2023-02-11T16:24:10-0800","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1676161450247_-43240059","id":"20200501-215114_1780935962","dateCreated":"2023-02-11T16:24:10-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65295"}],"name":"hdfs/cluster_nodes_storage","id":"2HRSGPJVP","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"angular:shared_process":[],"sh:shared_process":[],"jdbc:shared_process":[],"livy:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}