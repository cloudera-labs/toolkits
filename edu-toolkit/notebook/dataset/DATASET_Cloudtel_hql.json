{"paragraphs":[{"text":"%md\n# About\n**Objective:** Create a Hive database for Spark.\n**File locations:**\n**Successful outcome:** Create the Cloudtel database\n**Before you begin:**\n**Related lessons:** Spark\n\n---","user":"sysadmin","dateUpdated":"2021-05-03T15:08:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>About</h1>\n<p><strong>Objective:</strong> Create a Hive database for Spark.\n<br  /><strong>File locations:</strong>\n<br  /><strong>Successful outcome:</strong> Create the Cloudtel database\n<br  /><strong>Before you begin:</strong>\n<br  /><strong>Related lessons:</strong> Spark</p>\n<hr />\n"}]},"apps":[],"jobName":"paragraph_1620001326714_-467316513","id":"20171105-200834_1116095891","dateCreated":"2021-05-03T00:22:06+0000","dateStarted":"2021-05-03T15:08:38+0000","dateFinished":"2021-05-03T15:08:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:108933"},{"text":"%md\n# Setup","user":"sysadmin","dateUpdated":"2021-05-03T15:08:06+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Setup</h1>\n"}]},"apps":[],"jobName":"paragraph_1620054451791_1638384543","id":"20210503-150731_1261205724","dateCreated":"2021-05-03T15:07:31+0000","dateStarted":"2021-05-03T15:08:06+0000","dateFinished":"2021-05-03T15:08:06+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:108934"},{"title":"1 - Move the account data in tmp","text":"%sh\n\nrm -r /tmp/clouddtel\nmkdir -p /tmp/cloudtel/account\ncp -r /var/data/cloudtel/static_data/account/* /tmp/cloudtel/account/","user":"sysadmin","dateUpdated":"2021-05-03T03:20:20+0000","config":{"tableHide":false,"editorSetting":{"language":"sh","editOnDblClick":false,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/sh","editorHide":false,"fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"rm: cannot remove ‘/tmp/clouddtel’: No such file or directory\n"}]},"apps":[],"jobName":"paragraph_1620001326719_-129802731","id":"20171105-201709_849284875","dateCreated":"2021-05-03T00:22:06+0000","dateStarted":"2021-05-03T03:19:49+0000","dateFinished":"2021-05-03T03:19:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:108935"},{"title":"2 - List the contents of the directory","text":"%sh\n\nls /tmp/cloudtel/account","user":"sysadmin","dateUpdated":"2021-05-03T03:13:22+0000","config":{"tableHide":false,"editorSetting":{"language":"sh","editOnDblClick":false,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/sh","editorHide":false,"fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"part-m-00000\npart-m-00001\npart-m-00002\npart-m-00003\npart-m-00004\n"}]},"apps":[],"jobName":"paragraph_1620001326719_1356541760","id":"20201108-211841_1403877501","dateCreated":"2021-05-03T00:22:06+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:108936"},{"title":"3 - Create the directory in HDFS","text":"%sh\n\nsudo -u hdfs hdfs dfs -rm -r -skipTrash /data/cloudtel/account\nsudo -u hdfs hdfs dfs -mkdir -p /data/cloudtel/account","user":"sysadmin","dateUpdated":"2021-05-03T03:28:22+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/sh","editorHide":false,"fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Deleted /data/telco/account\n"}]},"apps":[],"jobName":"paragraph_1620001326719_2023662815","id":"20181115-092436_561920580","dateCreated":"2021-05-03T00:22:06+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:108937"},{"title":"4 - Put the data into the directory in HDFS","text":"%sh\n\nsudo -u hdfs hdfs dfs -put /tmp/cloudtel/account/ /data/cloudtel/\n","user":"sysadmin","dateUpdated":"2021-05-03T03:14:06+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/sh","editorHide":false,"fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1620001326720_1739166948","id":"20201108-212210_1922088787","dateCreated":"2021-05-03T00:22:06+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:108938"},{"title":"5 - List the data in the directory in HDFS","text":"%sh\n\nsudo -u hdfs hdfs dfs -ls /data/cloudtel/account/\n","user":"sysadmin","dateUpdated":"2021-05-03T03:14:16+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/sh","editorHide":false,"fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Found 5 items\n-rw-r--r--   3 hdfs hdfs    4706617 2020-11-20 18:19 /data/telco/account/part-m-00000\n-rw-r--r--   3 hdfs hdfs    4693530 2020-11-20 18:19 /data/telco/account/part-m-00001\n-rw-r--r--   3 hdfs hdfs    4674529 2020-11-20 18:19 /data/telco/account/part-m-00002\n-rw-r--r--   3 hdfs hdfs    4662646 2020-11-20 18:19 /data/telco/account/part-m-00003\n-rw-r--r--   3 hdfs hdfs        129 2020-11-20 18:19 /data/telco/account/part-m-00004\n"}]},"apps":[],"jobName":"paragraph_1620001326720_-1852648135","id":"20201108-212312_64664208","dateCreated":"2021-05-03T00:22:06+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:108939"},{"title":"6 - Create the telco database in Hive","text":"%jdbc(hive)\n\nDROP DATABASE IF EXISTS cloudtel CASCADE;\nCREATE DATABASE cloudtel;\n","user":"sysadmin","dateUpdated":"2021-05-03T03:14:53+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"database_name":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"java.sql.SQLException: Error while processing statement: FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. MetaException(message:java.security.AccessControlException: Permission denied: user=hive, access=WRITE, inode=\"/user/zeppelin/hive/name_dev\":zeppelin:hdfs:drwxr-xr-x\n\tat org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:399)\n\tat org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:261)\n\tat org.apache.ranger.authorization.hadoop.RangerHdfsAuthorizer$RangerAccessControlEnforcer.checkDefaultEnforcer(RangerHdfsAuthorizer.java:589)\n\tat org.apache.ranger.authorization.hadoop.RangerHdfsAuthorizer$RangerAccessControlEnforcer.checkPermission(RangerHdfsAuthorizer.java:377)\n\tat org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:193)\n\tat org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkPermission(FSDirectory.java:1859)\n\tat org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkPermission(FSDirectory.java:1843)\n\tat org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkPathAccess(FSDirectory.java:1793)\n\tat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.checkAccess(FSNamesystem.java:7804)\n\tat org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.checkAccess(NameNodeRpcServer.java:2217)\n\tat org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.checkAccess(ClientNamenodeProtocolServerSideTranslatorPB.java:1659)\n\tat org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:524)\n\tat org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1025)\n\tat org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:876)\n\tat org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:822)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:422)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)\n\tat org.apache.hadoop.ipc.Server$Handler.run(Server.java:2682)\n)\n\tat org.apache.hive.jdbc.HiveStatement.waitForOperationToComplete(HiveStatement.java:401)\n\tat org.apache.hive.jdbc.HiveStatement.execute(HiveStatement.java:266)\n\tat org.apache.commons.dbcp2.DelegatingStatement.execute(DelegatingStatement.java:291)\n\tat org.apache.commons.dbcp2.DelegatingStatement.execute(DelegatingStatement.java:291)\n\tat org.apache.zeppelin.jdbc.JDBCInterpreter.executeSql(JDBCInterpreter.java:718)\n\tat org.apache.zeppelin.jdbc.JDBCInterpreter.interpret(JDBCInterpreter.java:801)\n\tat org.apache.zeppelin.interpreter.LazyOpenInterpreter.interpret(LazyOpenInterpreter.java:103)\n\tat org.apache.zeppelin.interpreter.remote.RemoteInterpreterServer$InterpretJob.jobRun(RemoteInterpreterServer.java:633)\n\tat org.apache.zeppelin.scheduler.Job.run(Job.java:188)\n\tat org.apache.zeppelin.scheduler.ParallelScheduler$JobRunner.run(ParallelScheduler.java:162)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n"}]},"apps":[],"jobName":"paragraph_1620001326720_1286421682","id":"20201108-212635_669722160","dateCreated":"2021-05-03T00:22:06+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:108940"},{"title":"7 - Create the account table in Hive","text":"%jdbc(hive)\n\n-- # setup accounts table\nDROP TABLE IF EXISTS cloudtel.account;\n\nCREATE EXTERNAL TABLE cloudtel.account (\n    acct_num INT,\n    acct_create_dt TIMESTAMP,\n    acct_close_dt  TIMESTAMP,\n    first_name VARCHAR(255)  ,\n    last_name VARCHAR(255) ,\n    address  VARCHAR(255) ,\n    city  VARCHAR(255) ,\n    state VARCHAR(255) ,\n    zipcode VARCHAR(255) ,\n    phone_number VARCHAR(255) ,\n    created TIMESTAMP  ,\n    modified TIMESTAMP)\n    ROW FORMAT DELIMITED\n    FIELDS TERMINATED BY ','\n    STORED AS TEXTFILE\n    LOCATION '/data/cloudtel/account';\n","user":"sysadmin","dateUpdated":"2021-05-03T03:15:40+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Query executed successfully. Affected rows : -1"},{"type":"TEXT","data":"Query executed successfully. Affected rows : -1"}]},"apps":[],"jobName":"paragraph_1620001326720_-1827798992","id":"20201108-212744_298135404","dateCreated":"2021-05-03T00:22:06+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:108941"},{"title":"8 - Query the table cloudtel.account","text":"%jdbc(hive)\n\nSELECT * FROM cloudtel.account LIMIT 5;\n\n","user":"sysadmin","dateUpdated":"2021-05-03T03:29:16+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"account.acct_num":"string","account.acct_create_dt":"string","account.acct_close_dt":"string","account.first_name":"string","account.last_name":"string","account.address":"string","account.city":"string","account.state":"string","account.zipcode":"string","account.phone_number":"string","account.created":"string","account.modified":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"account.acct_num\taccount.acct_create_dt\taccount.acct_close_dt\taccount.first_name\taccount.last_name\taccount.address\taccount.city\taccount.state\taccount.zipcode\taccount.phone_number\taccount.created\taccount.modified\n1\t2008-10-23 16:05:05.0\tnull\tDonald\tBecton\t2275 Washburn Street\tOakland\tCA\t94660\t5100032418\t2014-03-18 13:29:47.0\t2014-03-18 13:29:47.0\n2\t2008-11-12 03:00:01.0\tnull\tDonna\tJones\t3885 Elliott Street\tSan Francisco\tCA\t94171\t4150835799\t2014-03-18 13:29:47.0\t2014-03-18 13:29:47.0\n3\t2008-12-21 09:19:50.0\tnull\tDorthy\tChalmers\t4073 Whaley Lane\tSan Mateo\tCA\t94479\t6506877757\t2014-03-18 13:29:47.0\t2014-03-18 13:29:47.0\n4\t2008-11-28 00:08:09.0\tnull\tLeila\tSpencer\t1447 Ross Street\tSan Mateo\tCA\t94444\t6503198619\t2014-03-18 13:29:47.0\t2014-03-18 13:29:47.0\n5\t2008-11-15 23:06:06.0\tnull\tAnita\tLaughlin\t2767 Hill Street\tRichmond\tCA\t94872\t5107754354\t2014-03-18 13:29:47.0\t2014-03-18 13:29:47.0\n"}]},"apps":[],"jobName":"paragraph_1620001326720_1011838771","id":"20201108-213030_279755854","dateCreated":"2021-05-03T00:22:06+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:108942"},{"text":"%angular\n","user":"sysadmin","dateUpdated":"2021-05-03T00:22:06+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/undefined","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1620001326720_240949015","id":"20181207-095756_1112890944","dateCreated":"2021-05-03T00:22:06+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:108943"}],"name":"DATASET/Cloudtel_hql","id":"2G6N7TE2R","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"psql:shared_process":[],"angular:shared_process":[],"sh:shared_process":[],"jdbc:shared_process":[],"spark2:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}