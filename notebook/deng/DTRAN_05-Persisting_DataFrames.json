{"paragraphs":[{"text":"%md\n# About\n**Lab:** Persisting DataFrames\n**Objective:** Explore DataFrame persistence.\n**File locations:**\n~~~console\n    Data files (HDFS): /user/zeppelin/accountdevice\n    Hive tables: telco.account\n~~~\n**Successful outcome:** understand the effects of DataFrame persistence on execution plans and storage strategies.\n**Before you begin:** \n**Related lessons:** \n\n---","user":"devuser","dateUpdated":"2020-12-10T02:21:27+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>About</h1>\n<p><strong>Lab:</strong> Persisting DataFrames\n<br  /><strong>Objective:</strong> Explore DataFrame persistence.\n<br  /><strong>File locations:</strong></p>\n<pre><code class=\"console\">    Data files (HDFS): /user/zeppelin/accountdevice\n    Hive tables: telco.account\n</code></pre>\n<p><strong>Successful outcome:</strong> understand the effects of DataFrame persistence on execution plans and storage strategies.\n<br  /><strong>Before you begin:</strong>\n<br  /><strong>Related lessons:</strong></p>\n<hr />\n"}]},"apps":[],"jobName":"paragraph_1603769357637_1791709050","id":"20181126-092644_1457476546","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-10T02:21:16+0000","dateFinished":"2020-12-10T02:21:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:223960"},{"text":"%md\n# Setup","user":"devuser","dateUpdated":"2020-12-02T21:22:22+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Setup</h1>\n"}]},"apps":[],"jobName":"paragraph_1603769357637_325407559","id":"20181201-044336_178705192","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T21:22:12+0000","dateFinished":"2020-12-02T21:22:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223962"},{"title":"Check that the account table exists in the telco database","text":"%jdbc(hive_interactive)\nUSE telco;\nSHOW TABLES;","user":"devuser","dateUpdated":"2020-12-10T02:29:29+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"1":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"tab_name":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","title":true,"editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Query executed successfully. Affected rows : -1"},{"type":"TABLE","data":"tab_name\naccount\nname_dev\n"}]},"apps":[],"jobName":"paragraph_1607567239944_1688156006","id":"20201210-022719_417749241","dateCreated":"2020-12-10T02:27:19+0000","dateStarted":"2020-12-10T02:29:28+0000","dateFinished":"2020-12-10T02:29:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223963"},{"title":"Import a clean dataset to HDFS","text":"%sh\nhdfs dfs -rm -r -skipTrash /user/zeppelin/account_device\nrm -rf /tmp/account_device\ncp -r /var/data/telco/account_device /tmp/\nhdfs dfs -put /tmp/account_device /user/zeppelin/","user":"devuser","dateUpdated":"2020-12-10T02:37:28+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Deleted /user/zeppelin/account_device\n"}]},"apps":[],"jobName":"paragraph_1606944098483_-168681154","id":"20201202-212138_1755672533","dateCreated":"2020-12-02T21:21:38+0000","dateStarted":"2020-12-10T02:37:28+0000","dateFinished":"2020-12-10T02:37:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223964"},{"title":"Unpersist the accountDevDF DataFrame","text":"%pyspark\naccountDevDF.unpersist()","user":"devuser","dateUpdated":"2020-12-10T02:37:35+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Fail to execute line 1: accountDevDF.unpersist()\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-2870812626390353064.py\", line 380, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 1, in <module>\nNameError: name 'accountDevDF' is not defined\n"}]},"apps":[],"jobName":"paragraph_1606944108220_466321959","id":"20201202-212148_552881564","dateCreated":"2020-12-02T21:21:48+0000","dateStarted":"2020-12-10T02:37:35+0000","dateFinished":"2020-12-10T02:37:35+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:223965"},{"text":"%md\n# Lab\n","user":"devuser","dateUpdated":"2020-10-27T03:29:17+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Lab</h1>\n"}]},"apps":[],"jobName":"paragraph_1603769357637_1842390665","id":"20181126-093358_358613711","dateCreated":"2020-10-27T03:29:17+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:223966"},{"text":"%md\n### Compare the Execution Plans of Persisted and Unpersisted Queries","user":"devuser","dateUpdated":"2020-10-27T03:29:17+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Compare the Execution Plans of Persisted and Unpersisted Queries</h3>\n"}]},"apps":[],"jobName":"paragraph_1603769357638_157812616","id":"20200426-035337_1420000263","dateCreated":"2020-10-27T03:29:17+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:223967"},{"title":"1 - Join accounts with their associated devices","text":"%pyspark\n# stub: query setup\naccountDF = spark.read.table(\"telco.account\")\naccountDeviceDF = spark.read.option(\"header\",\"true\").option(\"inferSchema\",\"true\").csv(\"/user/zeppelin/account_device\")\naccountDevDF =  accountDF.join(accountDeviceDF,accountDF.acct_num == accountDeviceDF.account_id)","user":"devuser","dateUpdated":"2020-12-10T02:44:15+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1603769357638_1823157139","id":"20200429-210012_1471698944","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-10T02:44:15+0000","dateFinished":"2020-12-10T02:44:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223968"},{"title":" ","text":"%md\nCreate a DataFrame that joins account data for all accounts with their associated devices. To save time and effort, some stub code has been provided for you.","user":"devuser","dateUpdated":"2020-12-02T20:57:41+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Create a DataFrame that joins account data for all accounts with their associated devices. To save time and effort, some stub code has been provided for you.</p>\n"}]},"apps":[],"jobName":"paragraph_1603769357638_-1369852377","id":"20200426-035404_1322046437","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T20:57:30+0000","dateFinished":"2020-12-02T20:57:30+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223969"},{"title":"2 - Display info from the new DataFrame","text":"%pyspark\naccountDevDF. \\\nselect(\"acct_num\",\"first_name\",\"last_name\",\"device_id\"). \\\nshow(5)","user":"devuser","dateUpdated":"2020-12-10T02:44:20+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+----------+---------+---------+\n|acct_num|first_name|last_name|device_id|\n+--------+----------+---------+---------+\n|       1|    Donald|   Becton|       29|\n|       1|    Donald|   Becton|        9|\n|       2|     Donna|    Jones|        5|\n|       3|    Dorthy| Chalmers|        5|\n|       4|     Leila|  Spencer|       38|\n+--------+----------+---------+---------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1604887982851_1595723962","id":"20201109-021302_536818331","dateCreated":"2020-11-09T02:13:02+0000","dateStarted":"2020-12-10T02:44:20+0000","dateFinished":"2020-12-10T02:44:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223970"},{"title":"","text":"%md\n\nThe query code above defines a new DataFrame called `accountDevDF`, which joins account data and device data. Try executing a query starting with the `accountDevDF` DataFrame that displays the account number, first name, last name and device ID for each row.","user":"devuser","dateUpdated":"2020-12-02T19:35:12+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":false,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>The query code above defines a new DataFrame called <code>accountDevDF</code>, which joins account data and device data. Try executing a query starting with the <code>accountDevDF</code> DataFrame that displays the account number, first name, last name and device ID for each row.</p>\n"}]},"apps":[],"jobName":"paragraph_1603769357638_-928192130","id":"20200426-035403_1370280892","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T19:35:12+0000","dateFinished":"2020-12-02T19:35:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223971"},{"title":"3 - Note the complexity of the query you just executed","text":"%md\nIn your browser, go to the **SQL** tab of your application's Spark UI.\n(Ambari > Spark2 > Spark2 History Server UI > click on an application ID > Select the SQL tab)\n\nView the execution visualization of the query you just executed. Take note of the complexity so that you can compare it to later executions when using persistence. \n\nRemember that queries are listed in the **SQL** tab in the order they were executed, starting with the most recent.\nThe descriptions of multiple executions of the same action will not distinguish one query from another, so make sure you choose the correct one for the query you are looking at.","user":"devuser","dateUpdated":"2020-12-10T02:50:13+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>In your browser, go to the <strong>SQL</strong> tab of your application's Spark UI.\n<br  />(Ambari > Spark2 > Spark2 History Server UI > click on an application ID > Select the SQL tab)</p>\n<p>View the execution visualization of the query you just executed. Take note of the complexity so that you can compare it to later executions when using persistence.</p>\n<p>Remember that queries are listed in the <strong>SQL</strong> tab in the order they were executed, starting with the most recent.\n<br  />The descriptions of multiple executions of the same action will not distinguish one query from another, so make sure you choose the correct one for the query you are looking at.</p>\n"}]},"apps":[],"jobName":"paragraph_1603769357639_1052231985","id":"20200426-035402_1252980857","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-10T02:50:13+0000","dateFinished":"2020-12-10T02:50:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223972"},{"title":"4 - Persist accountDevDF","text":"%pyspark\naccountDevDF.persist()","user":"devuser","dateUpdated":"2020-12-10T02:44:25+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DataFrame[acct_num: int, acct_create_dt: timestamp, acct_close_dt: timestamp, first_name: string, last_name: string, address: string, city: string, state: string, zipcode: string, phone_number: string, created: timestamp, modified: timestamp, id: int, account_id: int, device_id: int, activation_date: bigint, account_device_id: string]\n"}]},"apps":[],"jobName":"paragraph_1603769357639_741508323","id":"20200426-035401_1324998326","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-10T02:44:25+0000","dateFinished":"2020-12-10T02:44:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223973"},{"title":"","text":"%md\nIn your Spark shell, persist the `accountDevDF` DataFrame using the default storage level.","user":"devuser","dateUpdated":"2020-11-09T02:15:55+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":false,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>In your Spark shell, persist the <code>accountDevDF</code> DataFrame using the default storage level.</p>\n"}]},"apps":[],"jobName":"paragraph_1603769357639_2104931727","id":"20200426-035401_1680646515","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T02:15:55+0000","dateFinished":"2020-11-09T02:15:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223974"},{"title":"5 - Repeat the select query you executed above","text":"%pyspark\naccountDevDF. \\\nselect(\"acct_num\",\"first_name\",\"last_name\",\"device_id\"). \\\nshow(5)","user":"devuser","dateUpdated":"2020-12-10T02:38:40+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+----------+---------+---------+\n|acct_num|first_name|last_name|device_id|\n+--------+----------+---------+---------+\n|       1|    Donald|   Becton|       29|\n|       1|    Donald|   Becton|        9|\n|       2|     Donna|    Jones|        5|\n|       3|    Dorthy| Chalmers|        5|\n|       4|     Leila|  Spencer|       38|\n+--------+----------+---------+---------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1603769357639_212733288","id":"20200426-035400_914284045","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-10T02:38:40+0000","dateFinished":"2020-12-10T02:38:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223975"},{"title":"6 - Compare the execution diagram of this query with the one executed before","text":"%md\nIn the browser, reload the Spark UI **SQL** tab, and view the execution diagram for the query just executed. \n\nNotice that it has far fewer steps. Instead of reading, filtering, and joining the data from the two sources, it reads the persisted data from memory. \n\nIf you hover your mouse over the memory scan step, you will see that the only operation it performs on the data in memory is the last step of the query: the unpersisted select transformation. \n\nCompare the diagram for this query with the first one you executed above, before persisting.","user":"devuser","dateUpdated":"2020-12-02T20:40:49+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>In the browser, reload the Spark UI <strong>SQL</strong> tab, and view the execution diagram for the query just executed.</p>\n<p>Notice that it has far fewer steps. Instead of reading, filtering, and joining the data from the two sources, it reads the persisted data from memory.</p>\n<p>If you hover your mouse over the memory scan step, you will see that the only operation it performs on the data in memory is the last step of the query: the unpersisted select transformation.</p>\n<p>Compare the diagram for this query with the first one you executed above, before persisting.</p>\n"}]},"apps":[],"jobName":"paragraph_1603769357639_-165902358","id":"20200426-035358_1654934869","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T20:40:49+0000","dateFinished":"2020-12-02T20:40:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223976"},{"title":"7 - Analyze the two execution diagrams","text":"%md\nThe first time you execute a query on a persisted DataFrame, Dataset, or RDD, Spark has to execute the full query in order to materialize the data that gets saved in memory or on disk. \n\nCompare the difference between the first and second queries after executing `persist` by re-executing the query one final time. Then use the Spark UI to compare both queries executed after the `persist` operation, and consider these questions:\n\n- Do the execution diagrams differ? Why or why not?\n- Did one query take longer than the other? If so, which one, and why?","user":"devuser","dateUpdated":"2020-12-02T20:42:29+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>The first time you execute a query on a persisted DataFrame, Dataset, or RDD, Spark has to execute the full query in order to materialize the data that gets saved in memory or on disk.</p>\n<p>Compare the difference between the first and second queries after executing <code>persist</code> by re-executing the query one final time. Then use the Spark UI to compare both queries executed after the <code>persist</code> operation, and consider these questions:</p>\n<ul>\n<li>Do the execution diagrams differ? Why or why not?</li>\n<li>Did one query take longer than the other? If so, which one, and why?</li>\n</ul>\n"}]},"apps":[],"jobName":"paragraph_1603769357640_1382723525","id":"20200426-035358_848001533","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T20:42:29+0000","dateFinished":"2020-12-02T20:42:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223977"},{"text":"%md\n#### View Storage for Persisted DataFrames","user":"devuser","dateUpdated":"2020-11-09T04:05:48+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>View Storage for Persisted DataFrames</h4>\n"}]},"apps":[],"jobName":"paragraph_1603769357640_1607128117","id":"20200426-035357_341037510","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T04:05:48+0000","dateFinished":"2020-11-09T04:05:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223978"},{"title":"8 - Review the properties of the RDD","text":"%md\nView the **Storage** tab in the Spark UI to see currently persisted data. The list shows the RDD identified by the execution plan for the query that generated the data. Consider these questions:\n\n- What is the storage level of the RDD?\n- How many partitions of the RDD were persisted and how much space do those partitions take up in memory and on disk?\n- Note that only a small percentage of the data is cached. Why is that? How could you cache more of the data?\n- Click the RDD name to view the storage details. Which executors are storing data for this RDD?","user":"devuser","dateUpdated":"2020-12-02T20:47:26+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>View the <strong>Storage</strong> tab in the Spark UI to see currently persisted data. The list shows the RDD identified by the execution plan for the query that generated the data. Consider these questions:</p>\n<ul>\n<li>What is the storage level of the RDD?</li>\n<li>How many partitions of the RDD were persisted and how much space do those partitions take up in memory and on disk?</li>\n<li>Note that only a small percentage of the data is cached. Why is that? How could you cache more of the data?</li>\n<li>Click the RDD name to view the storage details. Which executors are storing data for this RDD?</li>\n</ul>\n"}]},"apps":[],"jobName":"paragraph_1603769357640_903528987","id":"20200426-035346_198043054","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T20:47:11+0000","dateFinished":"2020-12-02T20:47:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223979"},{"title":"9 - Execute a query using the write action to save the DataFrame to HDFS","text":"%pyspark\naccountDevDF.write.mode(\"overwrite\"). \\\nsave(\"/user/zeppelin/account_device\")","user":"devuser","dateUpdated":"2020-12-10T02:44:51+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1603769357640_-1309005150","id":"20200426-035345_1468680125","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-10T02:44:51+0000","dateFinished":"2020-12-10T02:44:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223980"},{"title":"","text":"%md\nExecute a query on the same DataFrame as above, but use the write action instead of show.","user":"devuser","dateUpdated":"2020-12-02T20:50:54+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Execute a query on the same DataFrame as above, but use the write action instead of show.</p>\n"}]},"apps":[],"jobName":"paragraph_1603769357640_-841061942","id":"20200426-035345_2068263348","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T20:50:44+0000","dateFinished":"2020-12-02T20:50:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223981"},{"title":"10 - Analyze the storage used with the new query","text":"%md\nReload the Spark UI **Storage** tab.\n\n- What percentage of the data is cached? Why? How does this compare to the last time you persisted the data?\n- How much memory is the data taking up? How much disk space?","user":"devuser","dateUpdated":"2020-12-02T20:51:32+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Reload the Spark UI <strong>Storage</strong> tab.</p>\n<ul>\n<li>What percentage of the data is cached? Why? How does this compare to the last\n<br  />time you persisted the data?</li>\n<li>How much memory is the data taking up? How much disk space?</li>\n</ul>\n"}]},"apps":[],"jobName":"paragraph_1603769357641_-188488063","id":"20200426-062545_1647187544","dateCreated":"2020-10-27T03:29:17+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:223982"},{"text":"%md\n#### Change the Storage Level for the Persisted DataFrame","user":"devuser","dateUpdated":"2020-11-09T04:06:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Change the Storage Level for the Persisted DataFrame</h4>\n"}]},"apps":[],"jobName":"paragraph_1603769357641_-1309192909","id":"20200426-062544_2035581418","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T04:06:21+0000","dateFinished":"2020-11-09T04:06:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223983"},{"title":"11 - Unpersist the accountsDevsDF DataFrame","text":"%pyspark\naccountDevDF.unpersist()","user":"devuser","dateUpdated":"2020-12-10T02:45:03+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DataFrame[acct_num: int, acct_create_dt: timestamp, acct_close_dt: timestamp, first_name: string, last_name: string, address: string, city: string, state: string, zipcode: string, phone_number: string, created: timestamp, modified: timestamp, id: int, account_id: int, device_id: int, activation_date: bigint, account_device_id: string]\n"}]},"apps":[],"jobName":"paragraph_1603769357641_-984374632","id":"20200426-062544_2125101715","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-10T02:45:03+0000","dateFinished":"2020-12-10T02:45:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223984"},{"title":"12 - Verify that the cache has been removed","text":"%md\nView the Spark UI **Storage** to verify that the cache for `accountDevDF` has been removed.","user":"devuser","dateUpdated":"2020-12-02T20:51:53+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true,"editorHide":false,"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>View the Spark UI <strong>Storage</strong> to verify that the cache for <code>accountDevDF</code> has been removed.</p>\n"}]},"apps":[],"jobName":"paragraph_1603769357641_575047299","id":"20200426-062543_1322148377","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T02:18:32+0000","dateFinished":"2020-11-09T02:18:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223985"},{"title":"13 - Persist the same DataFrame again","text":"%pyspark\nfrom pyspark import StorageLevel\n\naccountDevDF.persist(StorageLevel.DISK_ONLY_2)","user":"devuser","dateUpdated":"2020-12-10T02:45:06+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DataFrame[acct_num: int, acct_create_dt: timestamp, acct_close_dt: timestamp, first_name: string, last_name: string, address: string, city: string, state: string, zipcode: string, phone_number: string, created: timestamp, modified: timestamp, id: int, account_id: int, device_id: int, activation_date: bigint, account_device_id: string]\n"}]},"apps":[],"jobName":"paragraph_1603769357641_-880790907","id":"20200426-062542_1989337635","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-10T02:45:06+0000","dateFinished":"2020-12-10T02:45:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223986"},{"title":" ","text":"%md\nRepersist the same DataFrame, setting the storage level to save the data files on disk, replicated twice.","user":"devuser","dateUpdated":"2020-11-09T02:19:15+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":false,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Repersist the same DataFrame, setting the storage level to save the data files on disk, replicated twice.</p>\n"}]},"apps":[],"jobName":"paragraph_1603769357641_-218047132","id":"20200426-062542_123835292","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T02:18:45+0000","dateFinished":"2020-11-09T02:18:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223987"},{"title":"14 - Re-execute the save action","text":"%pyspark\naccountDevDF.write.mode(\"overwrite\").save(\"/user/zeppelin/account_device\")","user":"devuser","dateUpdated":"2020-12-10T02:45:13+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1603769357642_1595895850","id":"20200426-062541_564847369","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-10T02:45:13+0000","dateFinished":"2020-12-10T02:45:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223988"},{"title":"15 - Analyze how the data is stored","text":"%md\nReload the **Storage** tab to confirm that the storage level for the RDD is set correctly.\nAlso consider these questions:\n\n- How much memory is the data taking up? How much disk space?\n- Which executors are storing the RDD's data files?\n- How many partitions are stored? Are they replicated? Where?","user":"devuser","dateUpdated":"2020-12-02T20:53:04+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Reload the <strong>Storage</strong> tab to confirm that the storage level for the RDD is set correctly.\n<br  />Also consider these questions:</p>\n<ul>\n<li>How much memory is the data taking up? How much disk space?</li>\n<li>Which executors are storing the RDD's data files?</li>\n<li>How many partitions are stored? Are they replicated? Where?</li>\n</ul>\n"}]},"apps":[],"jobName":"paragraph_1603769357642_1492395635","id":"20200426-062541_214949809","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T02:19:29+0000","dateFinished":"2020-11-09T02:19:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223989"},{"text":"%md\n# Reset","user":"devuser","dateUpdated":"2020-12-02T21:22:19+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Reset</h1>\n"}]},"apps":[],"jobName":"paragraph_1606942564008_-1930005811","id":"20201202-205604_291729539","dateCreated":"2020-12-02T20:56:04+0000","dateStarted":"2020-12-02T21:22:19+0000","dateFinished":"2020-12-02T21:22:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223990"},{"title":"Import a clean dataset to HDFS","text":"%sh\nhdfs dfs -rm -r -skipTrash /user/zeppelin/account_device\nrm -rf /tmp/account_device\ncp -r /var/data/telco/account_device /tmp/\nhdfs dfs -put /tmp/account_device /user/zeppelin/","user":"devuser","dateUpdated":"2020-12-10T02:45:20+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Deleted /user/zeppelin/account_device\n"}]},"apps":[],"jobName":"paragraph_1606942600403_-1364777853","id":"20201202-205640_890137626","dateCreated":"2020-12-02T20:56:40+0000","dateStarted":"2020-12-10T02:45:20+0000","dateFinished":"2020-12-10T02:45:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223991"},{"title":"Unpersist the accountDevDF DataFrame","text":"%pyspark\naccountDevDF.unpersist()","user":"devuser","dateUpdated":"2020-12-10T02:45:27+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DataFrame[acct_num: int, acct_create_dt: timestamp, acct_close_dt: timestamp, first_name: string, last_name: string, address: string, city: string, state: string, zipcode: string, phone_number: string, created: timestamp, modified: timestamp, id: int, account_id: int, device_id: int, activation_date: bigint, account_device_id: string]\n"}]},"apps":[],"jobName":"paragraph_1606942684617_-963841927","id":"20201202-205804_274501944","dateCreated":"2020-12-02T20:58:04+0000","dateStarted":"2020-12-10T02:45:27+0000","dateFinished":"2020-12-10T02:45:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223992"},{"text":"%md\n# Exercise","user":"devuser","dateUpdated":"2020-12-02T20:53:57+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Exercise</h1>\n"}]},"apps":[],"jobName":"paragraph_1603769357642_1826735907","id":"20181018-125200_1133281582","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T20:53:47+0000","dateFinished":"2020-12-02T20:53:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223993"},{"text":"%md\n### Compare the Execution Plans of Persisted and Unpersisted Queries","user":"devuser","dateUpdated":"2020-11-09T04:06:53+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Compare the Execution Plans of Persisted and Unpersisted Queries</h3>\n"}]},"apps":[],"jobName":"paragraph_1603769357642_1885619012","id":"20200429-205813_408772061","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T04:06:53+0000","dateFinished":"2020-11-09T04:06:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223994"},{"title":"1 - Join accounts with their associated devices","text":"%pyspark\naccountDF = spark.read.table(\"telco.account\")\naccountDeviceDF = spark.read.option(\"header\",\"true\").option(\"inferSchema\",\"true\").csv(\"/user/zeppelin/accountdevice\")\n# Create a new DataFrame from the result of joining accountDF's acct_num column and accountDeviceDF's account_id column\naccountDevDF =  ","user":"devuser","dateUpdated":"2020-12-02T19:33:57+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1603769357643_548049256","id":"20200429-205812_1635150681","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T04:08:23+0000","dateFinished":"2020-11-09T04:08:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223995"},{"title":"2 - Display info from the new DataFrame","text":"%pyspark\n","user":"devuser","dateUpdated":"2020-12-02T19:34:15+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+----------+---------+---------+\n|acct_num|first_name|last_name|device_id|\n+--------+----------+---------+---------+\n|       1|    Donald|   Becton|       29|\n|       1|    Donald|   Becton|        9|\n|       2|     Donna|    Jones|        5|\n|       3|    Dorthy| Chalmers|        5|\n|       4|     Leila|  Spencer|       38|\n+--------+----------+---------+---------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1603769357643_-850422641","id":"20200429-205855_48052881","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T04:08:32+0000","dateFinished":"2020-11-09T04:08:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223996"},{"title":"3 - Note the complexity of the query you just executed","text":"%md\nIn your browser, go to the **SQL** tab of your application's Spark UI, and view the execution visualization of the query you just executed. Take note of the complexity so that you can compare it to later executions when using persistence. \n\nRemember that queries are listed in the **SQL** tab in the order they were executed, starting with the most recent.\nThe descriptions of multiple executions of the same action will not distinguish one query from another, so make sure you choose the correct one for the query you are looking at.","user":"devuser","dateUpdated":"2020-12-02T19:36:51+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>In your browser, go to the <strong>SQL</strong> tab of your application's Spark UI, and view the execution visualization of the query you just executed. Take note of the complexity so that you can compare it to later executions when using persistence.</p>\n<p>Remember that queries are listed in the <strong>SQL</strong> tab in the order they were executed, starting with the most recent.\n<br  />The descriptions of multiple executions of the same action will not distinguish one query from another, so make sure you choose the correct one for the query you are looking at.</p>\n"}]},"apps":[],"jobName":"paragraph_1603769357643_-711885357","id":"20200429-205854_1575015129","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T19:36:51+0000","dateFinished":"2020-12-02T19:36:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223997"},{"title":"4 - Persist accountsDevsDF","text":"%pyspark\n","user":"devuser","dateUpdated":"2020-12-02T19:37:19+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DataFrame[acct_num: int, acct_create_dt: timestamp, acct_close_dt: timestamp, first_name: string, last_name: string, address: string, city: string, state: string, zipcode: string, phone_number: string, created: timestamp, modified: timestamp, id: int, account_id: int, device_id: int, activation_date: bigint, account_device_id: string]\n"}]},"apps":[],"jobName":"paragraph_1603769357643_-114336717","id":"20200429-205854_261598927","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T04:08:41+0000","dateFinished":"2020-11-09T04:08:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223998"},{"title":"5 - Repeat the select query you executed above","text":"%pyspark\n","user":"devuser","dateUpdated":"2020-12-02T20:41:22+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+----------+---------+---------+\n|acct_num|first_name|last_name|device_id|\n+--------+----------+---------+---------+\n|       1|    Donald|   Becton|       29|\n|       1|    Donald|   Becton|        9|\n|       2|     Donna|    Jones|        5|\n|       3|    Dorthy| Chalmers|        5|\n|       4|     Leila|  Spencer|       38|\n+--------+----------+---------+---------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1603769357643_76389891","id":"20200429-205852_1436750479","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T04:08:51+0000","dateFinished":"2020-11-09T04:08:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:223999"},{"title":"6 - Compare the execution diagram of this query with the one executed before","text":"%md\nIn the browser, reload the Spark UI **SQL** tab, and view the execution diagram for the query just executed. \n\nNotice that it has far fewer steps. Instead of reading, filtering, and joining the data from the two sources, it reads the persisted data from memory. \n\nIf you hover your mouse over the memory scan step, you will see that the only operation it performs on the data in memory is the last step of the query: the unpersisted select transformation. \n\nCompare the diagram for this query with the first one you executed above, before persisting.","user":"devuser","dateUpdated":"2020-12-02T20:40:52+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>In the browser, reload the Spark UI <strong>SQL</strong> tab, and view the execution diagram for the query just executed.</p>\n<p>Notice that it has far fewer steps. Instead of reading, filtering, and joining the data from the two sources, it reads the persisted data from memory.</p>\n<p>If you hover your mouse over the memory scan step, you will see that the only operation it performs on the data in memory is the last step of the query: the unpersisted select transformation.</p>\n<p>Compare the diagram for this query with the first one you executed above, before persisting.</p>\n"}]},"apps":[],"jobName":"paragraph_1603769357643_519556622","id":"20200429-205851_2101455775","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T20:40:52+0000","dateFinished":"2020-12-02T20:40:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:224000"},{"title":"7 - Analyze the two execution diagrams","text":"%md\nThe first time you execute a query on a persisted DataFrame, Dataset, or RDD, Spark has to execute the full query in order to materialize the data that gets saved in memory or on disk. \n\nCompare the difference between the first and second queries after executing `persist` by re-executing the query one final time. Then use the Spark UI to compare both queries executed after the `persist` operation, and consider these questions:\n- Do the execution diagrams differ? Why or why not?\n- Did one query take longer than the other? If so, which one, and why?","user":"devuser","dateUpdated":"2020-12-02T20:42:34+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>The first time you execute a query on a persisted DataFrame, Dataset, or RDD, Spark has to execute the full query in order to materialize the data that gets saved in memory or on disk.</p>\n<p>Compare the difference between the first and second queries after executing <code>persist</code> by re-executing the query one final time. Then use the Spark UI to compare both queries executed after the <code>persist</code> operation, and consider these questions:</p>\n<ul>\n<li>Do the execution diagrams differ? Why or why not?</li>\n<li>Did one query take longer than the other? If so, which one, and why?</li>\n</ul>\n"}]},"apps":[],"jobName":"paragraph_1603769357644_182738990","id":"20200429-205850_795239181","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T20:42:34+0000","dateFinished":"2020-12-02T20:42:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:224001"},{"text":"%md\n#### View Storage for Persisted DataFrames","user":"devuser","dateUpdated":"2020-11-09T02:20:38+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>View Storage for Persisted DataFrames</h4>\n"}]},"apps":[],"jobName":"paragraph_1603769357644_1853273219","id":"20200429-205850_1346508345","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T02:20:38+0000","dateFinished":"2020-11-09T02:20:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:224002"},{"title":"8 - Review the properties of the RDD","text":"%md\nView the **Storage** tab in the Spark UI to see currently persisted data. The list shows the RDD identified by the execution plan for the query that generated the data. Consider these questions:\n\n- What is the storage level of the RDD?\n- How many partitions of the RDD were persisted and how much space do those partitions take up in memory and on disk?\n- Note that only a small percentage of the data is cached. Why is that? How could you cache more of the data?\n- Click the RDD name to view the storage details. Which executors are storing data for this RDD?","user":"devuser","dateUpdated":"2020-12-02T20:47:28+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>View the <strong>Storage</strong> tab in the Spark UI to see currently persisted data. The list shows the RDD identified by the execution plan for the query that generated the data. Consider these questions:</p>\n<ul>\n<li>What is the storage level of the RDD?</li>\n<li>How many partitions of the RDD were persisted and how much space do those partitions take up in memory and on disk?</li>\n<li>Note that only a small percentage of the data is cached. Why is that? How could you cache more of the data?</li>\n<li>Click the RDD name to view the storage details. Which executors are storing data for this RDD?</li>\n</ul>\n"}]},"apps":[],"jobName":"paragraph_1603769357644_-1992180782","id":"20200429-205849_384433336","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-12-02T20:47:17+0000","dateFinished":"2020-12-02T20:47:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:224003"},{"title":"9 - Execute a query using the write action to save the DataFrame to HDFS","text":"%pyspark\naccountDevDF.write.mode(\"overwrite\").save(\"/user/zeppelin/account_device\")","user":"devuser","dateUpdated":"2020-12-02T20:49:43+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1603769357644_-1167295064","id":"20200429-205849_124172407","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T04:09:07+0000","dateFinished":"2020-11-09T04:09:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:224004"},{"title":"10 - Analyze the storage used with the new query","text":"%md\nReload the Spark UI **Storage** tab.\n\n- What percentage of the data is cached? Why? How does this compare to the last time you persisted the data?\n- How much memory is the data taking up? How much disk space?","user":"devuser","dateUpdated":"2020-12-02T20:51:23+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1603769357644_861489576","id":"20200429-205848_1867896831","dateCreated":"2020-10-27T03:29:17+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:224005"},{"text":"%md\n#### Change the Storage Level for the Persisted DataFrame","user":"devuser","dateUpdated":"2020-11-09T02:21:02+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Change the Storage Level for the Persisted DataFrame</h4>\n"}]},"apps":[],"jobName":"paragraph_1603769357644_2031644622","id":"20200429-205847_1965596134","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T02:21:02+0000","dateFinished":"2020-11-09T02:21:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:224006"},{"title":"11 - Unpersist the accountDevDF DataFrame","text":"%pyspark\n","user":"devuser","dateUpdated":"2020-12-02T20:52:03+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DataFrame[acct_num: int, acct_create_dt: timestamp, acct_close_dt: timestamp, first_name: string, last_name: string, address: string, city: string, state: string, zipcode: string, phone_number: string, created: timestamp, modified: timestamp, id: int, account_id: int, device_id: int, activation_date: bigint, account_device_id: string]\n"}]},"apps":[],"jobName":"paragraph_1603769357645_35017788","id":"20200429-205847_1443153254","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T04:09:29+0000","dateFinished":"2020-11-09T04:09:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:224007"},{"title":"12 - Verify that the cache has been removed","text":"%md\nView the Spark UI **Storage** to verify that the cache for `accountDevDF` has been removed.","user":"devuser","dateUpdated":"2020-12-02T20:52:01+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1603769357645_2005886034","id":"20200429-205845_471575397","dateCreated":"2020-10-27T03:29:17+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:224008"},{"title":"13 - Persist the same DataFrame again","text":"%pyspark\n","user":"devuser","dateUpdated":"2020-12-02T20:52:23+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DataFrame[acct_num: int, acct_create_dt: timestamp, acct_close_dt: timestamp, first_name: string, last_name: string, address: string, city: string, state: string, zipcode: string, phone_number: string, created: timestamp, modified: timestamp, id: int, account_id: int, device_id: int, activation_date: bigint, account_device_id: string]\n"}]},"apps":[],"jobName":"paragraph_1603769357645_-1340670752","id":"20200429-205845_961146902","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T04:09:43+0000","dateFinished":"2020-11-09T04:09:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:224009"},{"title":"14 - Re-execute the save action","text":"%pyspark\n","user":"devuser","dateUpdated":"2020-12-02T20:52:50+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1603769357645_1831265645","id":"20200429-205844_451916861","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T04:09:51+0000","dateFinished":"2020-11-09T04:09:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:224010"},{"title":"15 - Analyze how the data is stored","text":"%md\nReload the **Storage** tab to confirm that the storage level for the RDD is set correctly.\nAlso consider these questions:\n\n- How much memory is the data taking up? How much disk space?\n- Which executors are storing the RDD's data files?\n- How many partitions are stored? Are they replicated? Where?","user":"devuser","dateUpdated":"2020-12-02T20:53:14+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1603769357645_-1616359617","id":"20200429-205842_2001073669","dateCreated":"2020-10-27T03:29:17+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:224011"},{"text":"%md\n# Result\n**You have now:** examined the effects of DataFrame persistence on execution plans and storage strategies.\n\n---","user":"devuser","dateUpdated":"2020-12-02T21:25:20+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Result</h1>\n<p><strong>You have now:</strong> examined the effects of DataFrame persistence on execution plans and storage strategies.</p>\n<hr />\n"}]},"apps":[],"jobName":"paragraph_1606942410891_-231703985","id":"20201202-205330_1878442001","dateCreated":"2020-12-02T20:53:30+0000","dateStarted":"2020-12-02T21:25:20+0000","dateFinished":"2020-12-02T21:25:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:224012"},{"text":"%md\nWe hope you've enjoyed this lab. Below are additional resources that you should find useful:\n\n1. [Cloudera Apache Spark Tutorials](http://hortonworks.com/tutorials/#tuts-developers) are your natural next step where you can explore Spark in more depth.\n2. [Cloudera Community Connection (HCC)](https://community.hortonworks.com/spaces/85/data-science.html?type=question) is a great resource for questions and answers on Spark, Data Analytics/Science, and many more Big Data topics.\n3. [Cloudera Apache Spark Docs](https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.0.1/spark-overview/content/analyzing_data_with_apache_spark.html) - official Spark documentation.\n4. [Cloudera Apache Zeppelin Docs](https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.0.1/zeppelin-overview/content/overview.html) - official Zeppelin documentation.\n","user":"devuser","dateUpdated":"2020-11-09T02:22:02+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>We hope you've enjoyed this lab. Below are additional resources that you should find useful:</p>\n<ol>\n<li><a href=\"http://hortonworks.com/tutorials/#tuts-developers\">Cloudera Apache Spark Tutorials</a> are your natural next step where you can explore Spark in more depth.</li>\n<li><a href=\"https://community.hortonworks.com/spaces/85/data-science.html?type=question\">Cloudera Community Connection (HCC)</a> is a great resource for questions and answers on Spark, Data Analytics/Science, and many more Big Data topics.</li>\n<li><a href=\"https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.0.1/spark-overview/content/analyzing_data_with_apache_spark.html\">Cloudera Apache Spark Docs</a> - official Spark documentation.</li>\n<li><a href=\"https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.0.1/zeppelin-overview/content/overview.html\">Cloudera Apache Zeppelin Docs</a> - official Zeppelin documentation.</li>\n</ol>\n"}]},"apps":[],"jobName":"paragraph_1603769357646_434886300","id":"20181126-133017_244739700","dateCreated":"2020-10-27T03:29:17+0000","dateStarted":"2020-11-09T02:22:02+0000","dateFinished":"2020-11-09T02:22:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:224013"}],"name":"DTRAN/05-Persisting_DataFrames","id":"2FNMZ4VHA","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"jdbc:shared_process":[],"spark2:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}