{"paragraphs":[{"text":"%md\n# About This Exercise\n**Title:** Create Hive External Database cloudhr\n**Objective:** \n        Create a Hive external database\n**File locations:** No data\n**Successful outcome:** A Hive external database cloudhr\n**Before you begin:** N/A\n**Related lessons:** Ranger\n\n---","user":"denis_deng","dateUpdated":"2022-04-03T16:41:42-0700","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>About This Exercise</h1>\n<p><strong>Title:</strong> Create Hive External Database cloudhr\n<br  /><strong>Objective:</strong></p>\n<pre><code>    Create a Hive external database\n</code></pre>\n<p><strong>File locations:</strong> No data\n<br  /><strong>Successful outcome:</strong> A Hive external database cloudhr\n<br  /><strong>Before you begin:</strong> N/A\n<br  /><strong>Related lessons:</strong> Ranger</p>\n<hr />\n"}]},"apps":[],"jobName":"paragraph_1649029302031_-1818621312","id":"20181126-092644_1457476546","dateCreated":"2022-04-03T16:41:42-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1141"},{"text":"%md\n# Setup","user":"denis_deng","dateUpdated":"2022-04-03T16:41:42-0700","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Setup</h1>\n"}]},"apps":[],"jobName":"paragraph_1649029302032_1392814237","id":"20181201-044336_178705192","dateCreated":"2022-04-03T16:41:42-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1142"},{"title":"1 - Validate data engineer user TGT","text":"%sh\n\necho 'BadPass@1' | su -l denis_deng -c 'klist'\n","user":"denis_deng","dateUpdated":"2022-04-03T16:42:43-0700","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Password: Ticket cache: FILE:/tmp/krb5cc_213600005_UnxMfv\nDefault principal: denis_deng@EXAMPLE.COM\n\nValid starting       Expires              Service principal\n04/03/2022 16:42:43  04/04/2022 16:42:43  krbtgt/EXAMPLE.COM@EXAMPLE.COM\n\trenew until 04/10/2022 16:42:43\n"}]},"apps":[],"jobName":"paragraph_1649029302033_-1750002165","id":"20210502-211214_424378971","dateCreated":"2022-04-03T16:41:42-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1143","dateFinished":"2022-04-03T16:42:43-0700","dateStarted":"2022-04-03T16:42:43-0700"},{"text":"%md\n#Exercise\n","user":"denis_deng","dateUpdated":"2022-04-03T16:41:42-0700","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Exercise</h1>\n"}]},"apps":[],"jobName":"paragraph_1649029302033_1108534584","id":"20211017-151821_2147248195","dateCreated":"2022-04-03T16:41:42-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1144"},{"title":"2 - Check status of databases","text":"%jdbc(hive)\n\nSHOW DATABASES;\n","user":"denis_deng","dateUpdated":"2022-04-03T16:42:51-0700","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"database_name":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}},"2":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"tab_name":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"database_name\nclouddev\nclouddev_stage\ncloudsale\ncloudsale_stage\ndefault\ninformation_schema\nsys\n"}]},"apps":[],"jobName":"paragraph_1649029302033_1365137381","id":"20211021-145218_934287784","dateCreated":"2022-04-03T16:41:42-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1145","dateFinished":"2022-04-03T16:42:51-0700","dateStarted":"2022-04-03T16:42:51-0700"},{"title":"3 - Create hive database cloudhr","text":"%jdbc(hive)\n\nDROP DATABASE IF EXISTS cloudhr CASCADE;\n\nCREATE DATABASE cloudhr\nLOCATION '/tenant/cloudhr/warehouse/tablespace/external/hive';\n\nALTER DATABASE cloudhr SET MANAGEDLOCATION 'hdfs://my-name-service/tenant/cloudhr/warehouse/tablespace/managed/hive/cloudhr.db';\n\nUSE cloudhr;\n\n\n","user":"denis_deng","dateUpdated":"2022-04-03T16:43:14-0700","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Query executed successfully. Affected rows : 0"},{"type":"TEXT","data":"Query executed successfully. Affected rows : 0"},{"type":"TEXT","data":"Query executed successfully. Affected rows : 0"},{"type":"TEXT","data":"Query executed successfully. Affected rows : 0"}]},"apps":[],"jobName":"paragraph_1649029302034_256033325","id":"20200522-200304_45153463","dateCreated":"2022-04-03T16:41:42-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1146","dateFinished":"2022-04-03T16:43:15-0700","dateStarted":"2022-04-03T16:43:14-0700"},{"text":"%md\n\n#### Hive Database Property MANAGEDLOCATION\n\nThe property MANAGEDLOCATION must be set to a URI when you specify an alternate location for a managed database.\nDo NOT set LOCATION and MANAGEDLOCATION to the same HDFS Path. This will result in an error.\nIn Hive_on_Tez you must add the property metastore.warehouse.tenant.colocation=true to Hive Service Advanced Configuration \n(hive-site.xml).\n","user":"denis_deng","dateUpdated":"2022-04-03T16:41:42-0700","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Hive Database Property MANAGEDLOCATION</h4>\n<p>The property MANAGEDLOCATION must be set to a URI when you specify an alternate location for a managed database.\n<br  />Do NOT set LOCATION and MANAGEDLOCATION to the same HDFS Path. This will result in an error.\n<br  />In Hive_on_Tez you must add the property metastore.warehouse.tenant.colocation=true to Hive Service Advanced Configuration\n<br  />(hive-site.xml).</p>\n"}]},"apps":[],"jobName":"paragraph_1649029302034_-789329206","id":"20220312-134901_586376993","dateCreated":"2022-04-03T16:41:42-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1147"},{"title":"4 - Create table claim_saving","text":"%jdbc(hive)\n\nDROP TABLE IF EXISTS cloudhr.claim_saving;\n\nCREATE EXTERNAL TABLE cloudhr.claim_saving(\n  claim_date DATE,\n  last_name STRING,\n  client_id INT,\n  claim_number INT,\n  claim_code DECIMAL(7,2),\n  claim_amount DECIMAL(7,2),\n  risk_factor DECIMAL(7,7),\n  claim_adjustment DECIMAL(7,2)\n  )\nROW FORMAT DELIMITED\nFIELDS TERMINATED BY ','\nLOCATION '/tenant/cloudhr/warehouse/tablespace/external/hive/cloudhr.db/claim_saving';\n","user":"denis_deng","dateUpdated":"2022-04-03T16:43:19-0700","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Query executed successfully. Affected rows : 0"},{"type":"TEXT","data":"Query executed successfully. Affected rows : 0"}]},"apps":[],"jobName":"paragraph_1649029302034_1771586431","id":"20191113-003528_2063258198","dateCreated":"2022-04-03T16:41:42-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1148","dateFinished":"2022-04-03T16:43:19-0700","dateStarted":"2022-04-03T16:43:19-0700"},{"title":"5 - Create table employee","text":"%jdbc(hive)\n\nDROP TABLE IF EXISTS cloudhr.employee;\n\nCREATE EXTERNAL TABLE cloudhr.employee(\n  emp_id INT,\n  name STRING,\n  age INT,\n  telephone STRING,\n  email STRING,\n  birthday DATE,\n  country_code STRING,\n  salary DECIMAL(7,2)\n  )\nROW FORMAT DELIMITED\nFIELDS TERMINATED BY ','\nLOCATION '/tenant/cloudhr/warehouse/tablespace/external/hive/cloudhr.db/employee';\n\n","user":"denis_deng","dateUpdated":"2022-04-03T16:43:25-0700","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Query executed successfully. Affected rows : 0"},{"type":"TEXT","data":"Query executed successfully. Affected rows : 0"}]},"apps":[],"jobName":"paragraph_1649029302035_-1474315159","id":"20210502-232157_1931600493","dateCreated":"2022-04-03T16:41:42-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1149","dateFinished":"2022-04-03T16:43:25-0700","dateStarted":"2022-04-03T16:43:25-0700"},{"title":"6 - Create table provider_summary","text":"%jdbc(hive)\n\nDROP TABLE IF EXISTS cloudhr.provider_summary;\n\nCREATE EXTERNAL TABLE cloudhr.provider_summary(\n    provider_id INT,\n    company_name STRING,\n    address STRING,\n    city STRING,\n    state_code STRING,\n    zip_code STRING,\n    regional_office STRING,\n    business_years INT,\n    claim_amount DECIMAL(7,2),\n    paid_amount DECIMAL(7,2),\n    adustment_amount DECIMAL(7,2)\n    )\nROW FORMAT DELIMITED\nFIELDS TERMINATED BY ','\nLOCATION '/tenant/cloudhr/warehouse/tablespace/external/hive/cloudhr.db/provider_summary';\n","user":"denis_deng","dateUpdated":"2022-04-03T16:43:31-0700","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Query executed successfully. Affected rows : 0"},{"type":"TEXT","data":"Query executed successfully. Affected rows : 0"}]},"apps":[],"jobName":"paragraph_1649029302035_1575960179","id":"20210502-232658_1687940699","dateCreated":"2022-04-03T16:41:42-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1150","dateFinished":"2022-04-03T16:43:31-0700","dateStarted":"2022-04-03T16:43:31-0700"},{"title":"7 - List cloudhr tables","text":"%jdbc(hive)\n\nUSE cloudhr;\nSHOW TABLES;\nDESCRIBE cloudhr.employee;\n","user":"denis_deng","dateUpdated":"2022-04-03T16:43:37-0700","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"tab_name":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}},"1":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"tab_name":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}},"2":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"col_name":"string","data_type":"string","comment":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Query executed successfully. Affected rows : 0"},{"type":"TABLE","data":"tab_name\nclaim_saving\nemployee\nprovider_summary\n"},{"type":"TABLE","data":"col_name\tdata_type\tcomment\nemp_id\tint\t\nname\tstring\t\nage\tint\t\ntelephone\tstring\t\nemail\tstring\t\nbirthday\tdate\t\ncountry_code\tstring\t\nsalary\tdecimal(7,2)\t\n"}]},"apps":[],"jobName":"paragraph_1649029302036_556544166","id":"20210503-000413_174249195","dateCreated":"2022-04-03T16:41:42-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1151","dateFinished":"2022-04-03T16:43:37-0700","dateStarted":"2022-04-03T16:43:37-0700"},{"text":"%md\n\n# Reset\n","user":"denis_deng","dateUpdated":"2022-04-03T16:41:42-0700","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Reset</h1>\n"}]},"apps":[],"jobName":"paragraph_1649029302036_-2130940180","id":"20210503-201327_1691139602","dateCreated":"2022-04-03T16:41:42-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1152"},{"title":"A - Drop database cloudhr ","text":"%jdbc(hive)\n\nDROP DATABASE IF EXISTS cloudhr CASCADE;\n","user":"denis_deng","dateUpdated":"2022-04-03T16:41:42-0700","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1649029302037_-701812432","id":"20210503-201344_78143625","dateCreated":"2022-04-03T16:41:42-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1153"},{"title":"B - Delete data from cloudhr","text":"%sh\n\necho 'BadPass@1' | su -l denis_deng -c 'hdfs dfs -rm -r -skipTrash /tenant/cloudhr/warehouse/external/hive/cloudhr.db'\n","user":"denis_deng","dateUpdated":"2022-04-03T16:41:42-0700","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1649029302037_114978015","id":"20220312-134731_2010931021","dateCreated":"2022-04-03T16:41:42-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1154"},{"text":"%angular\n","user":"denis_deng","dateUpdated":"2022-04-03T16:41:42-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/undefined","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1649029302038_-149246577","id":"20191113-001039_505978317","dateCreated":"2022-04-03T16:41:42-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1155"}],"name":"cloudhr/create_hive_database","id":"2GYMQXJNT","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"angular:shared_process":[],"sh:shared_process":[],"jdbc:shared_process":[],"livy:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}